# é¡¹ç›®å¯åŠ¨æ³¨æ„äº‹é¡¹

## ğŸ”„ å…³äºå®¹å™¨é‡å»ºå’Œé‡å¯

### æ˜¯å¦éœ€è¦é‡æ–°buildå®¹å™¨ï¼Ÿ

**ä¸éœ€è¦é‡æ–°buildå®¹å™¨**ï¼ŒåŸå› ï¼š
- æˆ‘ä»¬åªä¿®æ”¹äº† `docker-compose.yml` é…ç½®æ–‡ä»¶
- è¿™ä¸ªæ–‡ä»¶åœ¨å®¹å™¨å¯åŠ¨æ—¶è¯»å–ï¼Œä¸éœ€è¦é‡æ–°æ„å»ºé•œåƒ
- å·²ç»é€šè¿‡ `docker compose down` å’Œ `docker compose up -d` é‡å¯äº†å®¹å™¨

### ä½•æ—¶éœ€è¦é‡æ–°buildï¼Ÿ

åªæœ‰åœ¨ä»¥ä¸‹æƒ…å†µæ‰éœ€è¦é‡æ–°buildï¼š
- ä¿®æ”¹äº† `Dockerfile`
- ä¿®æ”¹äº† `requirements.txt` æˆ– `apt-requirements.txt`ï¼ˆæ·»åŠ äº†æ–°ä¾èµ–ï¼‰
- ä¿®æ”¹äº† `package.json`ï¼ˆæ·»åŠ äº†æ–°npmåŒ…ï¼‰
- ä¿®æ”¹äº†ROSå·¥ä½œç©ºé—´é…ç½®

### ä½•æ—¶åªéœ€è¦é‡å¯å®¹å™¨ï¼Ÿ

ä»¥ä¸‹æƒ…å†µåªéœ€è¦é‡å¯å®¹å™¨ï¼ˆ`docker compose restart` æˆ– `docker compose down && docker compose up -d`ï¼‰ï¼š
- ä¿®æ”¹äº† `docker-compose.yml`
- ä¿®æ”¹äº†ä»£ç æ–‡ä»¶ï¼ˆå¦‚ `.py`, `.js` æ–‡ä»¶ï¼‰
- ä¿®æ”¹äº†é…ç½®æ–‡ä»¶ï¼ˆå¦‚ `supervisord.conf`ï¼‰
- éœ€è¦æ›´æ–°å®¹å™¨å†…çš„ä»£ç ï¼ˆä½¿ç”¨ `docker cp` å¤åˆ¶æ–‡ä»¶åï¼‰

## ğŸ“‹ æ—¥å¸¸å¯åŠ¨æµç¨‹

### 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
# åœ¨å®¿ä¸»æœºç»ˆç«¯
cd ~/teleop/teleop
docker ps
```

**é¢„æœŸç»“æœï¼š** åº”è¯¥çœ‹åˆ° `teleop` å®¹å™¨æ­£åœ¨è¿è¡Œ

### 2. å¦‚æœå®¹å™¨æœªè¿è¡Œï¼Œå¯åŠ¨å®¹å™¨

```bash
cd ~/teleop/teleop
docker compose up -d
```

### 3. éªŒè¯é…ç½®

```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
docker exec teleop bash -c "echo 'CAMERA_MODE:' \$CAMERA_MODE && echo 'CAMERA_PRIMARY_DEVICE:' \$CAMERA_PRIMARY_DEVICE"

# æ£€æŸ¥è®¾å¤‡æ˜ å°„
docker exec teleop ls -l /dev/video0
```

### 4. å¯åŠ¨æœºå™¨äººå®¢æˆ·ç«¯ï¼ˆå®¹å™¨å†…ï¼‰

```bash
# æ‰“å¼€ç¬¬ä¸€ä¸ªç»ˆç«¯
ssh unloader@unloader1
docker exec -it teleop /bin/bash
source /opt/ros/humble/setup.bash
source ros2_ws/install/setup.bash
python gstreamer_webrtc.py
```

### 5. å¯åŠ¨æœºå™¨äººæ§åˆ¶ç«¯ï¼ˆå®¹å™¨å†…ï¼Œå¦ä¸€ä¸ªç»ˆç«¯ï¼‰

```bash
# æ‰“å¼€ç¬¬äºŒä¸ªç»ˆç«¯
ssh unloader@unloader1
docker exec -it teleop /bin/bash
source /opt/ros/humble/setup.bash
source ros2_ws/install/setup.bash
node joystick_webrtc.js
```

### 6. å¯åŠ¨Reactå‰ç«¯ï¼ˆå®¿ä¸»æœºï¼Œä¸æ˜¯å®¹å™¨å†…ï¼‰

```bash
# åœ¨æœ¬åœ°æœºå™¨æˆ–å‰ç«¯æœåŠ¡å™¨
cd ~/teleop/teleop/react-frontend
npm start
```

### 7. åœ¨å‰ç«¯é¡µé¢ç‚¹å‡» "Start" æŒ‰é’®

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### åœç”µåçš„å¤„ç†

1. **æ£€æŸ¥å®¹å™¨çŠ¶æ€**
   ```bash
   docker ps
   ```

2. **å¦‚æœå®¹å™¨å¼‚å¸¸ï¼Œé‡å¯å®¹å™¨**
   ```bash
   docker compose restart
   # æˆ–
   docker compose down && docker compose up -d
   ```

3. **æ£€æŸ¥æ‘„åƒå¤´è®¾å¤‡**
   ```bash
   ls -l /dev/video0
   sudo lsof /dev/video0  # æ£€æŸ¥æ˜¯å¦è¢«å ç”¨
   ```

4. **é‡æ–°å¯åŠ¨æ‰€æœ‰è¿›ç¨‹**ï¼ˆæŒ‰ç…§ä¸Šè¿°æ­¥éª¤4-7ï¼‰

### ä»£ç æ›´æ–°åçš„å¤„ç†

1. **å¦‚æœä¿®æ”¹äº†å®¹å™¨å†…çš„ä»£ç æ–‡ä»¶**ï¼ˆå¦‚ `gstreamer_webrtc.py`, `joystick_webrtc.js`ï¼‰ï¼š
   ```bash
   # å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨
   docker cp /home/unloader/teleop/teleop/gstreamer_webrtc.py teleop:/opt/app/gstreamer_webrtc.py
   docker cp /home/unloader/teleop/teleop/joystick_webrtc.js teleop:/opt/app/joystick_webrtc.js
   
   # é‡å¯ç›¸å…³è¿›ç¨‹ï¼ˆåœ¨å®¹å™¨å†…æŒ‰Ctrl+Cåœæ­¢ï¼Œç„¶åé‡æ–°è¿è¡Œï¼‰
   ```

2. **å¦‚æœä¿®æ”¹äº†å‰ç«¯ä»£ç **ï¼š
   ```bash
   # å‰ç«¯ä¼šè‡ªåŠ¨çƒ­é‡è½½ï¼ˆå¦‚æœä½¿ç”¨npm startï¼‰
   # æˆ–éœ€è¦é‡æ–°buildï¼ˆå¦‚æœä½¿ç”¨ç”Ÿäº§ç‰ˆæœ¬ï¼‰
   cd ~/teleop/teleop/react-frontend
   npm run build
   ```

### æ•…éšœæ’æŸ¥é¡ºåº

1. **æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ** â†’ `docker ps`
2. **æ£€æŸ¥ç¯å¢ƒå˜é‡** â†’ `docker exec teleop env | grep CAMERA`
3. **æ£€æŸ¥è®¾å¤‡æ˜ å°„** â†’ `docker exec teleop ls -l /dev/video0`
4. **æ£€æŸ¥è¿›ç¨‹æ˜¯å¦è¿è¡Œ** â†’ æŸ¥çœ‹ç»ˆç«¯æ˜¯å¦æœ‰é”™è¯¯
5. **æ£€æŸ¥å‰ç«¯è¿æ¥** â†’ æµè§ˆå™¨consoleæŸ¥çœ‹é”™è¯¯
6. **æ£€æŸ¥ç½‘ç»œè¿æ¥** â†’ ping signaling server

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### å®¹å™¨ç®¡ç†

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs teleop --tail 100

# é‡å¯å®¹å™¨
docker compose restart

# åœæ­¢å®¹å™¨
docker compose down

# å¯åŠ¨å®¹å™¨
docker compose up -d

# è¿›å…¥å®¹å™¨
docker exec -it teleop /bin/bash
```

### ä»£ç åŒæ­¥

```bash
# å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨
docker cp <æœ¬åœ°æ–‡ä»¶> teleop:/opt/app/<æ–‡ä»¶å>

# ä»å®¹å™¨å¤åˆ¶æ–‡ä»¶
docker cp teleop:/opt/app/<æ–‡ä»¶å> <æœ¬åœ°æ–‡ä»¶>
```

### éªŒè¯é…ç½®

```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
docker exec teleop env | grep CAMERA

# æ£€æŸ¥è®¾å¤‡
docker exec teleop ls -l /dev/video*

# æ£€æŸ¥æ–‡ä»¶MD5ï¼ˆéªŒè¯ä»£ç æ˜¯å¦åŒæ­¥ï¼‰
md5sum /home/unloader/teleop/teleop/gstreamer_webrtc.py
docker exec teleop md5sum /opt/app/gstreamer_webrtc.py
```

